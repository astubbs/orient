<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
    <head>
        <title>OrientDB Studio (www.orientechnologies.com)</title>
        <meta name="title" content="Document | DBMS | Database | Java | Studio" />
        <meta name="description" content="OrientDB Studio" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" type="text/css" media="screen" href="www/styles/redmond/jquery-ui-1.8.1.custom.css" />
        <link rel="stylesheet" type="text/css" media="screen" href="www/styles/ui.jqgrid.css" />
        <style>
            body {
                font-size: 10pt;
                font-family: Arial;
            }
            
            td {
                font-size: 10pt;
                font-family: Arial;
            }
            
            .cell_readonly {
                color: white;
                background-color: #6D7B8D;
            }
            
            .help {
                font-size: 13pt;
            }
        </style>
        <script src="www/js/jquery-1.4.2.min.js" type="text/javascript">
        </script>
        <script src="www/js/jquery-ui-1.8.1.custom.min.js" type="text/javascript">
        </script>
        <script src="www/js/i18n/grid.locale-en.js" type="text/javascript">
        </script>
        <script src="www/js/jquery.jqGrid.min.js" type="text/javascript">
        </script>
        <script src="www/js/jQueryRotate.js" type="text/javascript">
        </script>
        <script src="www/js/orient-app.js" type="text/javascript">
        </script>
        <script type="text/javascript">
            var startTime = 0;
            
            function queryResponse(data){
                var result = data["result"];
                
                jQuery("#output").val("Query executed in " + ((new Date().getTime() - startTime) / 1000) + " sec. Returned " + result.length + " record(s)");
                
                var columnNames = new Array();
                
                // CREATE COLUMN NAMES
                for (row = 0; row < result.length; row++) {
                    for (col in result[row]) {
                        if (!columnNames[col]) 
                            columnNames[col] = col;
                    }
                }
                
                // CREATE COLUMN MODEL
                var columnModel = new Array();
                
                columnModel.push({
                    "name": "_id",
                    "index": "_id",
                    "width": 30,
                    "classes": "cell_readonly"
                });
                columnModel.push({
                    "name": "_ver",
                    "index": "_ver",
                    "width": 30,
                    "classes": "cell_readonly"
                });
                columnModel.push({
                    "name": "_class",
                    "index": "_class",
                    "width": 30,
                    "classes": "cell_readonly"
                });
                
                for (col in columnNames) {
                    if (col.charAt(0) !== '_') {
                        columnModel.push({
                            "name": columnNames[col],
                            editable: true,
                            "index": columnNames[col],
                            "width": 80
                        });
                    }
                }
                
                var lastsel;
                
                jQuery($('#list')).jqGrid('GridUnload');
                fillDynaTable($('#list'), "Resultset", columnNames, columnModel, result, {
                    sortname: 'id',
                    height: 280,
                    editurl: getStudioDocumentURL(),
                    onSelectRow: function(id){
                        if (id && id !== lastsel) {
                            jQuery('#list').jqGrid('restoreRow', lastsel);
                            lastsel = id;
                        }
                        
                        var recId = jQuery('#list').jqGrid('getRowData', id)["_id"];
                        jQuery('#list').jqGrid('editRow', id, true, null, function(response, postdata){
                            jQuery("#output").val(response.responseText);
                            return true;
                        }, getStudioDocumentURL(), [recId]);
                    }
                });
                
                $("#newRecord").click(function(){
                    jQuery("#list").jqGrid('editGridRow', "new", {
                        height: 280,
                        reloadAfterSubmit: false,
                        closeOnEscape: true,
                        afterSubmit: function(response, postdata){
                            jQuery("#output").val(response.responseText);
                            return true;
                        }
                    });
                });
                $("#deleteRecord").click(function(){
                    var selectedRow = jQuery("#list").jqGrid('getGridParam', 'selrow');
                    if (selectedRow != null) {
                        var recId = jQuery('#list').jqGrid('getRowData', selectedRow)["_id"];
                        jQuery("#list").jqGrid('delGridRow', selectedRow, {
                            reloadAfterSubmit: false,
                            closeOnEscape: true,
                            delData: [recId],
                            afterSubmit: function(response, postdata){
                                jQuery("#output").val(response.responseText);
                                return true;
                            }
                        });
                    }
                    else 
                        alert("Please Select Row to delete!");
                });
            }
            
            function executeQuery(){
                startTime = new Date().getTime();
                
                jQuery("#queryText").val($('#queryText').val().trim());
                $.getJSON($('#server').val() + '/query/' + $('#database').val() + '/' + $('#queryText').val() + '/' + $('#limit').val(), queryResponse);
            }
            
            function clearResultset(){
                jQuery("#list").jqGrid('clearGridData');
            }
            
            function getStudioDocumentURL(){
                return $('#server').val() + '/studio-document/' + $('#database').val()
            }
            
            function executeRawCommand(){
                startTime = new Date().getTime();
                
                var req = $('#server').val() + '/' + $('#operation').val() + '/' + $('#database').val() + '/' + $('#args').val();
                
                $.ajax({
                    type: $('#method').val(),
                    url: req,
                    success: function(msg){
                        jQuery("#rawOutput").val(msg);
                        jQuery("#output").val("Raw command executed in " + ((new Date().getTime() - startTime) / 1000) + " sec.");
                    },
                    data: jQuery("#rawOutput").val(),
                    error: function(msg){
                        jQuery("#output").val("Command response: " + msg);
                    }
                });
            }
            
            function askServerInfo(){
                executeRequest($('#server').val() + '/server', function(server){
                    fillStaticTable($('#serverConnections'), ['Id', 'Database', 'Protocol', 'Total requests', 'Command type', 'Last command type', 'Last command detail', 'Last execution time', 'Total working time', 'Connected since'], server['connections']);
                    fillStaticTable($('#serverDbs'), ['Database', 'Open', 'Storage'], server['dbs']);
                    fillStaticTable($('#serverStorages'), ['Name', 'Type', 'Path', 'Active users'], server['storages']);
                    fillStaticTable($('#serverProfilerStats'), ['Name', 'Value'], server['profiler']['stats']);
                    fillStaticTable($('#serverProfilerChronos'), ['Name', 'Total', 'averageElapsed', 'minElapsed', 'maxElapsed', 'lastElapsed', 'totalElapsed'], server['profiler']['chronos']);
                });
            }
            
            var databaseInfo;
            function askDatabaseInfo(){
                executeRequest($('#server').val() + '/database/' + $('#database').val(), function(database){
                    databaseInfo = database;
                    
                    fillDynaTable($('#databaseClusters'), "Clusters", ['id', 'name', 'type', 'records'], null, database['clusters']);
                    fillDynaTable($('#classProperties'), "Properties", ['id', 'name', 'type', 'linkedType', 'linkedClass', 'mandatory', 'notNull', 'min', 'max'], [{
                        name: 'id',
                        index: 'id',
                        width: 55
                    }, {
                        name: 'name',
                        index: 'name',
                        width: 180
                    }, {
                        name: 'type',
                        index: 'type',
                        width: 80
                    }, {
                        name: 'linkedType',
                        index: 'linkedType',
                        width: 80
                    }, {
                        name: 'linkedClass',
                        index: 'linkedClass',
                        width: 80
                    }, {
                        name: 'mandatory',
                        index: 'linkedClass',
                        width: 30
                    }, {
                        name: 'notNull',
                        index: 'linkedClass',
                        width: 30
                    }, {
                        name: 'min',
                        index: 'linkedClass',
                        width: 30
                    }, {
                        name: 'max',
                        index: 'linkedClass',
                        width: 30
                    }], {
                        sortname: 'id'
                    });
                    
                    fillDynaTable($('#databaseClasses'), "Classes", ['id', 'name', 'clusters', 'defaultCluster', 'records'], null, database['classes'], {
                        sortname: 'id',
                        onSelectRow: function(classRowNum){
                            fillDynaTableRows($('#classProperties'), databaseInfo['classes'][classRowNum - 1]['properties']);
                        }
                    });
                });
            }
            
            function clear(component){
                $('#' + component).val("");
            }
            
            jQuery(document).ready(function(){
                jQuery(document).ajaxError(function(event, request, settings, err){
                    jQuery("#output").val("Error: " + request.responseText);
                });
                
                $("#tabs-main").tabs();
                $("#tabs-db").tabs();
                $("#tabs-server").tabs();
                
                $('#server').change(function(objEvent){
                    var s = $('#server').val();
                    if (s.charAt(s.length - 1) == "/") 
                        $('#server').val(s.substring(0, s.length - 1));
                    
                    $('#rawServer').html($('#server').val() + "/");
                });
                
                if (document.location.href.charAt(document.location.href.length - 1) == "/") 
                    $('#server').val(document.location.href.substring(0, document.location.href.length - 1));
                else 
                    $('#server').val(document.location.href);
            });
        </script>
    </head>
    <body>
        <table align="center" width="1000">
            <tr>
                <td>
                    <table style="width: 100%;" cellpadding="0" cellspacing="2">
                        <tr>
                            <td align="left">
                                <a href="http://www.orientechnologies.com/orient-db.htm"><img border="0" src="www/images/orient_db.png" /></a>
                            </td>
                            <td class="ui-widget">
                                Server: <input id="server" size="25" value="" />&nbsp;Database: <input id="database" size="10" value="demo" />
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td>
                    <div id="tabs-main">
                    <ul>
                        <li>
                            <a href="#tab-database"><span>Database</span></a>
                        </li>
                        <li>
                            <a href="#tab-query"><span>Query</span></a>
                        </li>
                        <li>
                            <a href="#tab-dictionary"><span>Dictionary</span></a>
                        </li>
                        <li>
                            <a href="#tab-raw"><span>Raw access</span></a>
                        </li>
                        <li>
                            <a href="#tab-server"><span>Server</span></a>
                        </li>
                    </ul>
                    <div id="tab-database">
                        <button onclick="javascript:askDatabaseInfo()" class="ui-button-text-icon">
                            Refresh <img border="0" alt="Refresh" src="www/images/execute.png" align="top" />
                        </button>
                        <div id="tabs-db">
                            <ul>
                                <li>
                                    <a href="#tab-db-schema"><span>Schema</span></a>
                                </li>
                                <li>
                                    <a href="#tab-db-structure"><span>Structure</span></a>
                                </li>
                                <li>
                                    <a href="#tab-db-security"><span>Security</span></a>
                                </li>
                            </ul>
                            <div id="tab-db-schema">
                                <table style="width: 100%;" cellpadding="5">
                                    <tr>
                                        <td valign="top" width="500">
                                            <table id="databaseClasses" style="width: 100%;" cellspacing="0" cellpadding="5" border="1">
                                            </table>
                                        </td>
                                        <td valign="top" class="help">
                                            Select the class to display the properties associated. Each class can store its records into one or multiple <b>Clusters</b>
                                            (see "Structure" tab).
                                            <br/>
                                            <br/>
                                            A class can be <b>schema-less</b>
                                            (has no properties), <b>schema-full</b>
                                            (all properties as mandatories) 
                                            or with a <b>partial schema</b>.
                                            <br/>
                                            <br/>
                                            The <b>defaultCluster</b>
                                            is the default place where the class record will be stored unless you want to store in a particular cluster of the class.
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td valign="top" colspan="2">
                                            <table id="classProperties" style="width: 100%;" cellspacing="0" cellpadding="5" border="1">
                                            </table>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div id="tab-db-structure">
                                <table style="width: 100%;" cellpadding="5">
                                    <tr>
                                        <td valign="top" width="500">
                                            <table id="databaseClusters" style="width: 100%;" cellspacing="0" cellpadding="5" border="1">
                                            </table>
                                        </td>
                                        <td valign="top" class="help">
                                            <b>Clusters</b>
                                            are sets of records grouped by a mean. Any mean you want to assign. You can use a Cluster like a Table of the Relational DBMS world, namely to group records of the same type. Or you could want to group records by different logics.
                                            <br/>
                                            <br/>
                                            There are two kinds of clusters: <b>Physical</b>
                                            and <b>Logical</b>. The first one uses ad-hoc files to speed up the I/O while the second one saves more space but it's slower. The suggestion is to use Physical Clusters for the records accessed often and where you need light speed.
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div id="tab-db-security">
                                <table style="width: 100%;" cellpadding="5">
                                    <tr>
                                        <td valign="top" width="500">
                                            <table id="databaseSecurity" style="width: 100%;" cellspacing="0" cellpadding="5" border="1">
                                            </table>
                                        </td>
                                        <td valign="top" class="help">
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div id="tab-query">
                        <table style="width: 100%;" cellpadding="0" cellspacing="2">
                            <tr>
                                <td valign="top">
                                    <table style="width: 100%;" cellpadding="2" cellspacing="0">
                                        <tr>
                                            <td valign="top">
                                                <textarea id="queryText" cols="120" rows="4" title="value">select from Address where city.country.name = 'Italy'</textarea>
                                            </td>
                                            <td>
                                                <table style="width: 100%;">
                                                    <tr>
                                                        <td align="center" style="font-size: 14pt;" >
                                                            <a href="http://code.google.com/p/orient/wiki/SQLQuery" target="help">SQL Syntax</a>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            <button onclick="javascript:executeQuery()" class="ui-button-text-icon">
                                                                Execute <img border="0" alt="Execute" src="www/images/execute.png" align="top" />
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td align="right">
                                                            Limit: <input id="limit" size="1" value="20" />
                                                        </td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td valign="top">
                                                <table id="list">
                                                </table>
                                            </td>
                                            <td valign="top">
                                                <table style="width: 100%;">
                                                    <tr>
                                                        <td>
                                                        <button id="newRecord" " class="ui-button-text-icon" style="width: 100px;  text-align: left">New <img border="0"  alt="New record" src="www/images/add.png" align="top" />
                                                        </button>
                                                    </td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            <button id="deleteRecord" class="ui-button-text-icon" style="width: 100px; text-align: left">
                                                                Delete <img border="0" alt="Delete record" src="www/images/delete.png" align="top" />
                                                            </button>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div id="tab-dictionary">
                        <table style="width: 100%;">
                        </table>
                    </div>
                    <div id="tab-raw">
                        <table style="width: 100%;">
                            <tr>
                                <td align="left">
                                </td>
                                <td align="left">
                                    <b>HTTP Method</b>
                                </td>
                                <td align="left">
                                    <b>Operation</b>
                                </td>
                                <td align="left">
                                    <b>Database</b>
                                </td>
                                <td align="left">
                                    <b>Argument(s)</b>
                                </td>
                                <td align="left">
                                </td>
                            </tr>
                            <tr>
                                <td id="rawServer">
                                    http://localhost:2480/
                                </td>
                                <td>
                                    <select id="method">
                                        <option value='GET'>GET</option>
                                        <option value='PUT'>PUT</option>
                                        <option value='POST'>POST</option>
                                        <option value='DELETE'>DELETE</option>
                                    </select>/
                                </td>
                                <td>
                                    <select id="operation">
                                        <option value='cluster'>cluster</option>
                                        <option value='class'>class</option>
                                        <option value='database'>database</option>
                                        <option value='dictionary'>dictionary</option>
                                        <option value='document'>document</option>
                                        <option value='query'>query</option>
                                        <option value='server'>server</option>
                                    </select>/
                                </td>
                                <td>
                                    <input id="database" size="15" value="demo" />/
                                </td>
                                <td>
                                    <input id="args" size="40" value="Address" />
                                </td>
                                <td>
                                    <button onclick="javascript:executeRawCommand()" style="background-color: #F0F0F0;">
                                        <img border="0" alt="Execute" src="www/images/execute.png" />
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="6" valign="top">
                                    <textarea id="rawOutput" cols="135" rows="22" title="value">
                                    </textarea>
                                    <a href="javascript:clear('rawOutput')"><img border="0" src="www/images/clear.png" /></a>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div id="tab-server">
                        <button onclick="javascript:askServerInfo()" class="ui-button-text-icon">
                            Refresh <img border="0" alt="Refresh" src="www/images/execute.png" align="top" />
                        </button>
                        <div id="tabs-server">
                            <ul>
                                <li>
                                    <a href="#tab-server-conns"><span>Active Connections</span></a>
                                </li>
                                <li>
                                    <a href="#tab-server-dbs"><span>Database pool</span></a>
                                </li>
                                <li>
                                    <a href="#tab-server-storages"><span>Used Storages</span></a>
                                </li>
                                <li>
                                    <a href="#tab-server-profiler"><span>Profiler</span></a>
                                </li>
                            </ul>
                            <div id="tab-server-conns">
                                <table style="width: 100%;">
                                    <tr>
                                        <td valign="top">
                                            <table id="serverConnections" style="width: 100%;" cellspacing="0" cellpadding="5" border="1">
                                            </table>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div id="tab-server-dbs">
                                <table style="width: 100%;">
                                    <tr>
                                        <td valign="top">
                                            <table id="serverDbs" style="width: 100%;" cellspacing="0" cellpadding="5" border="1">
                                            </table>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div id="tab-server-storages">
                                <table style="width: 100%;">
                                    <tr>
                                        <td valign="top">
                                            <table id="serverStorages" style="width: 100%;" cellspacing="0" cellpadding="5" border="1">
                                            </table>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div id="tab-server-profiler">
                                <table style="width: 100%;">
                                    <tr>
                                        <td valign="top">
                                            <table id="serverProfilerStats" style="width: 100%;" cellspacing="0" cellpadding="5" border="1">
                                            </table>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td valign="top">
                                            <table id="serverProfilerChronos" style="width: 100%;" cellspacing="0" cellpadding="5" border="1">
                                            </table>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <table style="width: 100%;">
                        <tr>
                            <td valign="top">
                                Output:
                            </td>
                            <td valign="top">
                                <textarea id="output" cols="125" rows="3" title="value" readonly="readonly">
                                </textarea>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td align="center">
                    To know more information visit: <a href="http://www.orientechnologies.com">http://www.orientechnologies.com</a>
                </td>
            </tr>
        </table>
    </body>
</html>
